# DEBUG CONFIG: Single Material, No Weak Zone
# Purpose: Isolate solver behavior without material complexity
# Units: SI (m, s, Pa, kg) unless otherwise specified

[domain]
# Domain size (meters) - SAME as full model
lx = 100_000.0  # 100 km
ly = 1_000.0    # 1 km (quasi-2D)
lz = 20_000.0   # 20 km

# Mesh resolution (meters) - COARSER for faster debugging
dx = 10_000.0   # 10 km (was 5 km)
dy = 1_000.0    # 1 km (1 cell)
dz = 5_000.0    # 5 km (was 3 km)

[simulation]
# Total simulation time (years) - SHORTER for debugging
total_time_years = 100_000.0  # 100 kyr (was 2 Myr)

# Output frequency (years) - Reduced for less file output
output_interval_years = 10_000.0  # 10 kyr (100 Ky / 10 = 10 outputs)

# Mesh quality check interval (years)
quality_check_interval_years = 5_000.0  # 5 kyr

[boundary_conditions]
# Extension rate (m/s), will be ramped up - SAME
extension_rate_cm_per_year = 1.0
extension_rate_m_per_s = 3.17e-10  # = 1 cm/yr

# Velocity ramp-up (years) - SHORTER for debugging
ramp_duration_years = 10_000.0  # 10 kyr (was 100 kyr)

# Boundary types (DES3D-style) - SAME
bc_x0 = "velocity"  # Left: vx = -v_ext
bc_x1 = "velocity"  # Right: vx = +v_ext
bc_y0 = "plane_strain"  # Back: vy = 0
bc_y1 = "plane_strain"  # Front: vy = 0
bc_z0 = "free_surface"   # Top: free surface
bc_z1 = "fixed_normal"   # Bottom: vz = 0

[initial_conditions]
# Temperature field
surface_temp_kelvin = 273.0
moho_temp_kelvin = 873.0
use_geotherm = true

# Stress state - SAME
use_lithostatic_pressure = true
gravity = 9.81

[materials]
# SINGLE HOMOGENEOUS MATERIAL - No layering
[materials.upper_crust]
depth_top = 0.0
depth_bottom = 30_000.0  # Full depth
density = 2700.0
viscosity = 1.0e21  # Pa·s (middle value)
cohesion_mpa = 30.0  # Reduced for easier yielding
cohesion_min_mpa = 4.0
friction_angle = 30.0
shear_modulus_pa = 3.0e10

# Lower crust DISABLED (same as upper)
[materials.lower_crust]
depth_top = 30_000.0
depth_bottom = 30_000.0  # Zero thickness = disabled
density = 2700.0
viscosity = 1.0e21
cohesion_mpa = 44.0
cohesion_min_mpa = 4.0
friction_angle = 30.0
shear_modulus_pa = 3.0e10

# Weak zone ENABLED for localization
[materials.weak_zone]
enabled = true
geometry = "dipping_plane"
x_center = 50_000.0
y_center = 500.0
depth_min = 5_000.0   # Start at 5 km depth
depth_max = 20_000.0  # Extend to bottom (domain is 20 km)
dip_angle = -60.0
azimuth = 15.0
half_width = 2_000.0  # Wider zone for easier initialization
viscosity = 1.0e20  # Lower viscosity for easier deformation
cohesion_mpa = 20.0  # Reduced for easier yielding
cohesion_min_mpa = 4.0
initial_plastic_strain = 0.0  # No pre-strain

[time_stepping]
# Adaptive time stepping
use_adaptive = true  # Enable adaptive CFL-based timestepping

# Time step limits (years)
dt_min_years = 10.0     # Minimum timestep
dt_max_years = 2000.0   # Maximum timestep (2 kyr)
dt_initial_years = 500.0  # Initial timestep (500 years)

# CFL condition
cfl_target = 0.5  # Standard CFL number for advection

# Constraints
use_cfl_constraint = true   # Enable CFL constraint
use_maxwell_constraint = false  # Maxwell time not needed for viscous flow
use_mesh_quality_constraint = true

[solver]
# Non-linear solver
nonlinear_solver = "JFNK"
max_nonlinear_iterations = 20
nonlinear_tolerance = 5.0e-4  # Slightly relaxed
nonlinear_abs_tolerance = 1.0e-7

# Linear solver
linear_solver = "GMRES"
gmres_restart = 200  # Larger restart for Stokes saddle-point system
gmres_max_iterations = 8000
gmres_tolerance = 5.0e-3  # Relaxed for faster convergence
gmres_abs_tolerance = 1.0e-8

# Preconditioner
use_picard_warmstart = false  # Skip for simplicity
picard_warmstart_iterations = 0

# Scaling
use_nondimensionalization = true

[tracers]
# Passive tracers for visualization
tracers_per_element = 4
total_tracers = 480  # 120 elements × 4

[output]
# Output format
format = "VTK"
output_dir = "./output/debug_single_material"

# Fields to save
save_velocity = true
save_pressure = true
save_stress = true
save_strain = true
save_material_id = true
save_tracers = true

[physics]
# Enable/disable physics
gravity_enabled = true
surface_processes_enabled = false
thermal_diffusion_enabled = false
winkler_foundation_enabled = false

# Surface diffusion (disabled)
surface_diffusion_kappa = 0.0
