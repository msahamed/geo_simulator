# Core Complex 2D Simulation Configuration
# Units: SI (m, s, Pa, kg) unless otherwise specified

[domain]
# Domain size (meters)
lx = 100_000.0  # 100 km
ly = 1_000.0    # 1 km (quasi-2D)
lz = 30_000.0   # 30 km

# Mesh resolution (meters)
dx = 5_000.0    # 5 km
dy = 1_000.0    # 1 km (1 cell)
dz = 3_000.0    # 3 km

[simulation]
# Total simulation time (years)
total_time_years = 2_000_000.0  # 2 Myr

# Output frequency (years)
output_interval_years = 10_000.0  # 10 kyr

# Mesh quality check interval (years)
quality_check_interval_years = 50_000.0  # 50 kyr

[boundary_conditions]
# Extension rate (m/s), will be ramped up
extension_rate_cm_per_year = 1.0
extension_rate_m_per_s = 3.17e-10  # = 1 cm/yr

# Velocity ramp-up (years)
ramp_duration_years = 100_000.0  # 100 kyr

# Boundary types (DES3D-style, vbc flag = 1)
# flag=1: normal component fixed, shear components free
# X boundaries: extension (pull apart)
bc_x0 = "velocity"  # Left: vx = -v_ext
bc_x1 = "velocity"  # Right: vx = +v_ext

# Y boundaries: plane strain (quasi-2D)
bc_y0 = "plane_strain"  # Back: vy = 0
bc_y1 = "plane_strain"  # Front: vy = 0

# Z boundaries
bc_z0 = "free_surface"   # Top: free surface
bc_z1 = "fixed_normal"   # Bottom: vz = 0, vx/vy free

[initial_conditions]
# Temperature field
surface_temp_kelvin = 273.0
moho_temp_kelvin = 873.0
use_geotherm = true

# Stress state
use_lithostatic_pressure = true
gravity = 9.81

[materials]
# Upper crust (strong layer)
[materials.upper_crust]
depth_top = 0.0
depth_bottom = 15_000.0  # 15 km
density = 2700.0
viscosity = 1.0e22  # Pa·s
cohesion_mpa = 44.0
cohesion_min_mpa = 4.0
friction_angle = 30.0
shear_modulus_pa = 3.0e10

# Lower crust (weak layer)
[materials.lower_crust]
depth_top = 15_000.0
depth_bottom = 30_000.0  # 30 km
density = 2800.0
viscosity = 1.0e21  # Pa·s (10x weaker)
cohesion_mpa = 20.0
cohesion_min_mpa = 2.0
friction_angle = 15.0
shear_modulus_pa = 3.0e10

# Weak zone (pre-existing shear zone)
[materials.weak_zone]
enabled = true
geometry = "dipping_plane"

# Geometry parameters
x_center = 50_000.0  # 50 km (center of domain)
y_center = 500.0     # 0.5 km
depth_min = 15_000.0  # 15 km (top of lower crust)
depth_max = 30_000.0  # 30 km (bottom)

# Dip angle (degrees from horizontal, negative = dips down)
dip_angle = -60.0
azimuth = 15.0

# Width
half_width = 1_200.0  # 1.2 km

# Rheology (very weak)
viscosity = 1.0e20  # Pa·s (100x weaker than lower crust)
cohesion_mpa = 2.0
cohesion_min_mpa = 0.2
initial_plastic_strain = 0.5  # Pre-weakened

[time_stepping]
# Adaptive time stepping
use_adaptive = true

# Time step limits (years)
dt_min_years = 1.0
dt_max_years = 100.0
dt_initial_years = 20.0

# CFL condition
cfl_target = 0.5

# Constraints
use_cfl_constraint = true
use_maxwell_constraint = true
use_mesh_quality_constraint = true

[solver]
# Non-linear solver
nonlinear_solver = "JFNK"  # or "Picard"
max_nonlinear_iterations = 20
nonlinear_tolerance = 1.0e-3
nonlinear_abs_tolerance = 1.0e-2

# Linear solver
linear_solver = "GMRES"
gmres_restart = 180
gmres_max_iterations = 1200
gmres_tolerance = 1.0e-4
gmres_abs_tolerance = 1.0e-9

# Preconditioner
use_picard_warmstart = true
picard_warmstart_iterations = 5

# Scaling
use_nondimensionalization = true

[tracers]
# Passive tracers for visualization
tracers_per_element = 4
total_tracers = 1600  # = 400 elements × 4

[output]
# Output format
format = "VTK"
output_dir = "./output/core_complex_2d"

# Fields to save
save_velocity = true
save_pressure = true
save_stress = true
save_strain = true
save_material_id = true
save_tracers = true

[physics]
# Enable/disable physics
gravity_enabled = true
surface_processes_enabled = false
thermal_diffusion_enabled = false
winkler_foundation_enabled = false

# Surface diffusion (if enabled)
surface_diffusion_kappa = 1.0e-6  # m²/yr
